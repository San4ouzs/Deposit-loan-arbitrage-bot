# Бот: поиск арбитража «депозит > кредит» и уведомления в Telegram

⚠️ ВАЖНО: это технический прототип-аггрегатор. Реальные продуктовые условия (комиссии, страхование, требования к резидентству, минимальные суммы, налог, эффективная ставка APR vs APY, раннее расторжение и т.п.) могут сделать любую «теоретическую» сделку невыгодной. Скрипт применяет консервативный штраф к спреду и может быть ужесточён под ваши правила.

## Что делает
1. Парсит агрегатор **deposits.org** по выбранным странам, чтобы получить ставки **депозитов (APY)** и **кредитов (APR)**.
2. Кросс‑сопоставляет предложения и отбирает кандидатов, где `APY_net - APR - penalty >= min_spread`.
   - `APY_net` — APY после учёта вашей налоговой ставки (config `advanced.user_tax_rate_pct`).
   - `penalty` — консервативный штраф в б.п. (config `advanced.conservative_penalty_bp`), чтобы нивелировать комиссии/условия.
3. Отправляет найденные варианты в **Telegram**.

## Быстрый старт
1. Установите зависимости (Python 3.10+):
   ```bash
   pip install -r requirements.txt
   ```
2. Настройте `config.yaml`:
   - Вставьте `telegram.bot_token` и `telegram.chat_id`.
   - При необходимости поправьте список `countries` и фильтры `product_filters`.
3. Запуск единоразовой проверки:
   ```bash
   python -m src.main
   ```

## Настройка Telegram
- Создайте бота через @BotFather, получите токен.
- Узнайте `chat_id`: отправьте сообщение боту, затем можно использовать бота @userinfobot или простой echo‑скрипт, чтобы увидеть ваш chat_id.
- Заполните `config.yaml`.

## Планировщик
Для регулярных проверок используйте cron/systemd или внешние оркестраторы. Пример cron (каждые 2 часа):
```
0 */2 * * * cd /path/to/deposit_loan_arbitrage_bot && /usr/bin/python -m src.main >> bot.log 2>&1
```

## Фильтры (config.yaml → product_filters)
- `min_deposit_apy` — минимальная ставка депозита для рассмотрения.
- `max_loan_apr` — максимальная ставка кредита для рассмотрения.
- `min_spread` — минимальный спред (в процентных пунктах) **после** штрафа и налога.
- Порог по срокам (`min_term_months`, `max_loan_term_months`) заложен как будущее расширение: текущий парсер не всегда извлекает сроки, но вы можете доработать.

## Источники данных
- **deposits.org** (HTML‑парсинг; структура может меняться).
- **ECB MIR** — опционально, как справочный бэкап средних ставок в еврозоне (см. `providers/ecb_mir.py`).

## Ограничения и идеи для апгрейда
- Добавить локальные источники с JSON (напр. открытое банкинг‑API там, где регуляторы требуют публикации продуктовых ставок).
- Учитывать реальные APR/Annual Equivalent Rate, комиссии за выдачу кредита, страховки, обязательные пакеты услуг.
- Включить гео‑/KYC‑фильтр (кто может открыть вклад/взять кредит).
- Хранить кэш и историю (SQLite/Postgres) и слать сигналы только при улучшении спреда.
- Поддержать прокси/rotating‑user‑agents при парсинге.
- Поддержать мульти‑чаты телеграма и команды ("/top", "/last").

## Юридический дисклеймер
Сценарий предназначен для **исследовательских целей** и не является финансовой рекомендацией. Перед действиями проверяйте условия на сайте банка/кредитора.
